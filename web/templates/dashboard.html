<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mordezzan Dashboard</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <style>
        .character-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .character-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            transition: transform 0.3s ease;
        }

        .character-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .character-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
        }

        .character-info {
            font-size: 16px;
            margin-bottom: 10px;
            color: #666;
        }

        .character-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .stat-item {
            text-align: center;
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-weight: bold;
            color: #2c3e50;
        }

        .character-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-view {
            background-color: #3498db;
            color: white;
        }

        .btn-view:hover {
            background-color: #2980b9;
        }

        .btn-create {
            background-color: #2ecc71;
            color: white;
            margin-left: auto;
        }

        .btn-create:hover {
            background-color: #27ae60;
        }

        .no-characters {
            text-align: center;
            padding: 40px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .welcome-banner {
            background-color: #34495e;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <div class="navbar">
        <div class="container">
            <a href="/" class="navbar-brand">Mordezzan</a>
            <ul class="navbar-menu">
                <li><a href="/">Dashboard</a></li>
                <li><a href="/profile" id="username-display"></a></li>
                <li><a href="#" id="logout-link">Logout</a></li>
            </ul>
        </div>
    </div>

    <div class="container">
        <div class="dashboard">
            <div class="welcome-banner">
                <h1>Welcome, <span id="welcome-username"></span>!</h1>
                <p>Select a character to manage or create a new one.</p>
            </div>

            <div class="dashboard-header">
                <div class="dashboard-title">Your Characters</div>
                <button class="btn btn-create" id="create-character-btn">Create New Character</button>
            </div>

            <div id="character-list" class="character-list">
                <!-- Character cards will be dynamically inserted here -->
            </div>

            <div id="no-characters" class="no-characters" style="display: none;">
                <h2>You don't have any characters yet</h2>
                <p>Click the "Create New Character" button to get started on your adventure!</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Check if user is logged in
            const token = localStorage.getItem('authToken');
            const userId = localStorage.getItem('userId');
            const username = localStorage.getItem('username');

            if (!token || !userId) {
                // Redirect to login if not logged in
                window.location.href = '/auth/login-page';
                return;
            }

            // Display username in navbar and welcome message
            document.getElementById('username-display').textContent = username;
            document.getElementById('welcome-username').textContent = username;

            // Logout functionality
            document.getElementById('logout-link').addEventListener('click', function (e) {
                e.preventDefault();
                localStorage.removeItem('authToken');
                localStorage.removeItem('userId');
                localStorage.removeItem('username');
                window.location.href = '/auth/login-page';
            });

            // Fetch user's characters
            fetchCharacters();

            // Create character button
            document.getElementById('create-character-btn').addEventListener('click', function () {
                window.location.href = '/characters/create';
            });
        });

        async function fetchCharacters() {
            try {
                const userId = localStorage.getItem('userId');
                const token = localStorage.getItem('authToken');

                const response = await fetch(`/api/users/${userId}/characters`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch characters');
                }

                const characters = await response.json();
                renderCharacters(characters);
            } catch (error) {
                console.error('Error fetching characters:', error);
            }
        }

        function renderCharacters(characters) {
            const characterListElement = document.getElementById('character-list');
            const noCharactersElement = document.getElementById('no-characters');

            // Clear any existing content
            characterListElement.innerHTML = '';

            if (characters.length === 0) {
                // Show the no characters message
                characterListElement.style.display = 'none';
                noCharactersElement.style.display = 'block';
                return;
            }

            // Show the character list
            characterListElement.style.display = 'grid';
            noCharactersElement.style.display = 'none';

            // Create a card for each character
            characters.forEach(character => {
                const card = document.createElement('div');
                card.className = 'character-card';
                card.innerHTML = `
                    <div class="character-name">${character.name}</div>
                    <div class="character-info">Level ${character.level} ${character.class}</div>
                    <div class="character-info">HP: ${character.hit_points}</div>
                    <div class="character-stats">
                        <div class="stat-item">
                            <div class="stat-label">STR</div>
                            <div class="stat-value">${character.strength}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">DEX</div>
                            <div class="stat-value">${character.dexterity}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">CON</div>
                            <div class="stat-value">${character.constitution}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">INT</div>
                            <div class="stat-value">${character.intelligence}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">WIS</div>
                            <div class="stat-value">${character.wisdom}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">CHA</div>
                            <div class="stat-value">${character.charisma}</div>
                        </div>
                    </div>
                    <div class="character-actions">
                        <a href="/characters/view/${character.id}" class="btn btn-view">View Details</a>
                    </div>
                `;
                characterListElement.appendChild(card);
            });
        }
    </script>
</body>

</html>