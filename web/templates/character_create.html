<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Character - Mordezzan</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <style>
        .character-form {
            max-width: 800px;
            margin: 40px auto;
            padding: 30px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .character-form h1 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
            margin-bottom: 25px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #3498db;
        }

        .ability-scores {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn-cancel {
            background-color: #95a5a6;
            color: white;
        }

        .btn-cancel:hover {
            background-color: #7f8c8d;
        }

        .btn-submit {
            background-color: #2ecc71;
            color: white;
        }

        .btn-submit:hover {
            background-color: #27ae60;
        }
    </style>
</head>

<body>
    <div class="navbar">
        <div class="container">
            <a href="/" class="navbar-brand">Mordezzan</a>
            <ul class="navbar-menu">
                <li><a href="/">Dashboard</a></li>
                <li><a href="/profile" id="username-display"></a></li>
                <li><a href="#" id="logout-link">Logout</a></li>
            </ul>
        </div>
    </div>

    <div class="container">
        <div class="character-form">
            <h1>Create a New Character</h1>

            <form id="create-character-form">
                <div class="form-section">
                    <h2>Character Information</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="character-name">Character Name</label>
                            <input type="text" id="character-name" name="name" required>
                        </div>

                        <div class="form-group">
                            <label for="character-class">Character Class</label>
                            <select id="character-class" name="class" required>
                                <option value="Fighter">Fighter</option>
                                <option value="Wizard">Wizard</option>
                                <option value="Cleric">Cleric</option>
                                <option value="Rogue">Rogue</option>
                                <option value="Druid">Druid</option>
                                <option value="Ranger">Ranger</option>
                                <option value="Paladin">Paladin</option>
                                <option value="Bard">Bard</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="character-level">Level</label>
                            <input type="number" id="character-level" name="level" min="1" max="20" value="1" required>
                        </div>

                        <div class="form-group">
                            <label for="hit-points">Hit Points</label>
                            <input type="number" id="hit-points" name="hit_points" min="1" value="10" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Ability Scores</h2>
                    <div class="ability-scores">
                        <div class="form-group">
                            <label for="strength">Strength</label>
                            <input type="number" id="strength" name="strength" min="3" max="18" value="10" required>
                        </div>
                        <div class="form-group">
                            <label for="dexterity">Dexterity</label>
                            <input type="number" id="dexterity" name="dexterity" min="3" max="18" value="10" required>
                        </div>
                        <div class="form-group">
                            <label for="constitution">Constitution</label>
                            <input type="number" id="constitution" name="constitution" min="3" max="18" value="10"
                                required>
                        </div>
                        <div class="form-group">
                            <label for="intelligence">Intelligence</label>
                            <input type="number" id="intelligence" name="intelligence" min="3" max="18" value="10"
                                required>
                        </div>
                        <div class="form-group">
                            <label for="wisdom">Wisdom</label>
                            <input type="number" id="wisdom" name="wisdom" min="3" max="18" value="10" required>
                        </div>
                        <div class="form-group">
                            <label for="charisma">Charisma</label>
                            <input type="number" id="charisma" name="charisma" min="3" max="18" value="10" required>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <a href="/" class="btn btn-cancel">Cancel</a>
                    <button type="submit" class="btn btn-submit">Create Character</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Check if user is logged in
            const token = localStorage.getItem('authToken');
            const userId = localStorage.getItem('userId');
            const username = localStorage.getItem('username');

            if (!token || !userId) {
                // Redirect to login if not logged in
                window.location.href = '/auth/login-page';
                return;
            }

            // Display username in navbar
            document.getElementById('username-display').textContent = username;

            // Logout functionality
            document.getElementById('logout-link').addEventListener('click', function (e) {
                e.preventDefault();
                localStorage.removeItem('authToken');
                localStorage.removeItem('userId');
                localStorage.removeItem('username');
                window.location.href = '/auth/login-page';
            });

            // Form submission
            document.getElementById('create-character-form').addEventListener('submit', async function (e) {
                e.preventDefault();

                const formData = {
                    user_id: parseInt(userId),
                    name: document.getElementById('character-name').value,
                    class: document.getElementById('character-class').value,
                    level: parseInt(document.getElementById('character-level').value),
                    strength: parseInt(document.getElementById('strength').value),
                    dexterity: parseInt(document.getElementById('dexterity').value),
                    constitution: parseInt(document.getElementById('constitution').value),
                    intelligence: parseInt(document.getElementById('intelligence').value),
                    wisdom: parseInt(document.getElementById('wisdom').value),
                    charisma: parseInt(document.getElementById('charisma').value),
                    hit_points: parseInt(document.getElementById('hit-points').value)
                };

                try {
                    const response = await fetch('/api/characters', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify(formData)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || 'Failed to create character');
                    }

                    // If successful, redirect to dashboard
                    window.location.href = '/';
                } catch (error) {
                    console.error('Error creating character:', error);
                    alert('Failed to create character: ' + error.message);
                }
            });
        });
    </script>
</body>

</html>